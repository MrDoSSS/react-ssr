"use strict";var e=require("./register-939ee7cc.js"),r=require("path"),t=require("fs-extra"),n=require("slash"),s=require("webpack"),a=require("webpack-merge"),i=require("mini-css-extract-plugin"),o=require("optimize-css-assets-webpack-plugin"),l=require("terser-webpack-plugin");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=c(r),d=c(t),f=c(n),p=c(s),b=c(i),g=c(o),m=c(l),j=e.promise,y=function(r){var t=e.getIteratorMethod(r);if("function"!=typeof t)throw TypeError(String(r)+" is not iterable");return e.anObject(t.call(r))};var v=function(r,t){if(void 0!==e.symbol&&e.isIterable(Object(r))){var n=[],s=!0,a=!1,i=void 0;try{for(var o,l=y(r);!(s=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==l.return||l.return()}finally{if(a)throw i}}return n}};var w=function(r,t){return e.arrayWithHoles(r)||v(r,t)||e.unsupportedIterableToArray(r,t)||e.nonIterableRest()},h=process.cwd(),_={performance:{hints:"warning"},output:{pathinfo:!1},optimization:{nodeEnv:"production",namedModules:!1,namedChunks:!1,flagIncludedChunks:!0,occurrenceOrder:!0,sideEffects:!0,usedExports:!0,concatenateModules:!1,splitChunks:{minSize:3e4,maxAsyncRequests:5,maxInitialRequests:3},minimize:!0,minimizer:[new g.default,new m.default]},plugins:[new p.default.DefinePlugin({"process.env.NODE_ENV":e.stringify("production")})]},x=process.cwd(),k="."+e.getEngine(),q=function(){var r=e.asyncToGenerator(e.regenerator.mark((function r(t){var n,s,a,i,o,l,c,p,b,g,m,j,y;return e.regenerator.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n={},r.next=3,e.getPages();case 3:for(s=r.sent,a=u.default.resolve(__dirname,"../../lib/webpack/".concat(e.ssrConfig.id,".js")),i=d.default.readFileSync(a).toString(),o=u.default.join(__dirname,"app.js"),d.default.existsSync(u.default.join(x,e.ssrConfig.viewsDir,"_app".concat(k)))&&(o=u.default.join(x,e.ssrConfig.viewsDir,"_app".concat(k))),t.mkdirpSync(u.default.join(x,"react-ssr-src")),l=0;l<s.length;l++)g=s[l],m=e.getPageId(g,"/"),j=u.default.dirname(m),y=u.default.basename(m),"."!==j&&t.mkdirpSync(u.default.join(x,"react-ssr-src",j)),t.writeFileSync(u.default.join(x,"react-ssr-src",j,e.concat(c="entry-".concat(y)).call(c,k)),i.replace("__REACT_SSR_APP__",f.default(o)).replace("__REACT_SSR_PAGE__",f.default(g))),n[e.getPageId(g,"_")]=e.concat(p=e.concat(b="./react-ssr-src/".concat(f.default(j),"/entry-")).call(b,y)).call(p,k);return r.abrupt("return",[n,s]);case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();exports.configureWebpack=function(r){var t={mode:"development",devtool:!e.isProd()&&"eval-source-map",entry:r,output:{path:u.default.join(h,e.ssrConfig.distDir),filename:"[name].js"},resolve:{extensions:[".js",".jsx",".ts",".tsx"]},module:{rules:[{test:/\.(js|ts)x?$/i,exclude:/node_modules/,use:{loader:require.resolve("babel-loader"),options:{cacheDirectory:!0,extends:e.existsSync(u.default.join(h,".babelrc"))?u.default.join(h,".babelrc"):e.existsSync(u.default.join(h,".babelrc.js"))?u.default.join(h,".babelrc.js"):e.existsSync(u.default.join(h,"babel.config.js"))?u.default.join(h,"babel.config.js"):u.default.join(__dirname,"../../lib/babel.js")}}},{test:/\.css$/i,use:[{loader:b.default.loader,options:{publicPath:u.default.join(h,e.ssrConfig.distDir),hmr:!e.isProd(),reloadAll:!0}},{loader:require.resolve("css-loader")}]},{test:/\.scss$/i,use:[{loader:b.default.loader,options:{publicPath:u.default.join(h,e.ssrConfig.distDir),hmr:!e.isProd(),reloadAll:!0}},{loader:require.resolve("css-loader")},{loader:require.resolve("sass-loader"),options:{sourceMap:!e.isProd()}}]}]},plugins:[new b.default({filename:"[name].css",chunkFilename:"[id].css",ignoreOrder:!0})]};return e.isProd()&&(t=a.smart(t,_)),e.ssrConfig.webpack&&("function"==typeof e.ssrConfig.webpack?t=e.ssrConfig.webpack(t,e.isProd()?"production":"development"):console.warn("[ warn ] ssr.config.js#webpack must be a function")),t},exports.getEntry=q,exports.promise=j,exports.slicedToArray=w;
